# 要件定義書

## Who’s Up

### 空気を可視化する Discord Bot

---

## 1. 概要

### 1.1 プロダクト概要

GameNight は、固定曜日や仕切り役を置かないゲーム Discord サーバーにおいて、
**「今〜数日先で、どれくらい人が集まりそうか」**を質問や調整なしで可視化する Bot である。

イベント管理・カレンダー型の調整ツールではなく、
**“集まれる気配”を一瞬で伝えること**に特化する。

> 決める Bot ではない。
> 集まりやすい空気を作る Bot。

---

## 2. 背景と課題

### 2.1 想定されるサーバー状況

- 小〜中規模（10〜30 人）のゲーム Discord
- VC 常連は 5〜10 人程度
- 固定の開催日・管理者・ホストが存在しない
- 海外メンバー混在による時差

### 2.2 ユーザー課題

- 誰が今起きている／来られるかわからない
- 「今日やる？」と聞く心理的コストが高い
- VC を立てても誰も来ない不安
- 結果として、遊べたはずの機会が流れる

**本質的な課題は「日程調整」ではなく「可視性不足」である。**

---

## 3. コンセプトと設計思想

### 3.1 コアコンセプト

- 質問しない
- 圧をかけない
- 決定しない

Bot は意思決定を代行せず、
**人が動きやすくなる状態だけを提示する。**

### 3.2 UX 方針

- 直感的（相対時間ベース）
- 低摩擦（誰でも使える）
- 非同期・非侵襲

---

## 4. ターゲットユーザー

- アクティブ 10〜30 人のゲーム Discord サーバー
- VC 常連 5〜10 人
- 固定イベントが存在しない
- 時差あり・海外メンバー混在
- 「暇な人」起点で自然に集まりたいコミュニティ

---

## 5. 機能要件（Phase 1）

### 5.1 対応コマンド

| コマンド | 目的                           | 自動クローズ |
| -------- | ------------------------------ | ------------ |
| `/soon`  | この後どう？（時間指定なし）   | 30 分        |
| `/later` | 先の予定の気配確認（日時必須） | 24 時間      |

---

### 5.2 コマンド共通仕様

| 項目        | 内容                                                                                   |
| ----------- | -------------------------------------------------------------------------------------- |
| パラメータ  | `/soon`: `[min_players]` `[game]`<br>`/later`: `[time]`（必須） `[min_players]` `[game]` |
| min_players | デフォルト 3                                                                           |
| game        | 表示用テキスト、省略可                                                                 |
| time        | `/later` のみ必須。任意の日時文字列（例: `Today 21:00`）                               |
| 実行権限    | 全ユーザー                                                                             |
| 言語        | 英語のみ                                                                               |

---

### 5.3 投票仕様

- Bot 投稿メッセージに対するリアクション投票
- 選択肢は全コマンド共通で以下に固定

  - 🟢 I can join
  - 🟡 Maybe
  - 🟠 Can't

- **排他制御（1 ユーザー 1 票）**
- 投票変更時は前回リアクションを自動解除

---

### 5.4 表示フォーマット

#### `/soon` 例

```
🎮 AmongUs anyone? (need 4)

🟢 I can join (2)
🟡 Maybe (1)
🟠 Can't (0)

👥 3/4
```

#### `/later` 例

```
🎮 Valorant anyone? (need 5)
🕒 Around: Today 21:00 (your local time)

🟢 I can join (3)
🟡 Maybe (1)
🟠 Can't (0)

👥 4/5
```

#### 閾値到達時
```

🎉 4 people are ready! @author

```

---

### 5.5 閾値通知

- 投票人数が `min_players` に到達した時点で
- **コマンド投稿者にのみメンション通知**
- 以降は再通知しない

---

### 5.6 キャンセル

- 投稿者が ❌ リアクションを付与すると即時終了
- 終了後は投票受付不可

---

### 5.7 自動クローズ

- `/soon` : コマンド実行から 30 分後に自動終了
- `/later` : コマンド実行から 24 時間後に自動終了（`time` の日時とは無関係）

クローズ時は **`Poll closed.` のみを表示**し、
理由説明・注意・次アクションの提案は行わない。

---

## 6. 非機能要件

### 6.1 パフォーマンス
- 同時進行ポーリング数は少数（〜数件）を想定
- リアルタイム更新はリアクションイベントベース

### 6.2 永続化
- Phase 1 は **完全メモリ管理（DB 不使用）**
- Bot 再起動時は全ポール破棄

### 6.3 可用性
- 失敗してもユーザー体験に致命的影響が出ない設計
- 再試行・復旧を前提としない

---

## 7. 技術要件

### 7.1 技術スタック（Phase 1）

```

Node.js 20
Discord.js
In-memory state

```

---

## 8. 検証指標（Phase 1）

### 定性・行動ベース指標

- 管理者以外がコマンドを使用した
- 1週間以内に複数回使われた
- 同一ユーザーが 2 回以上 `/now` を使用
- 投票後に VC が立った（主観可）
- 「地味に便利」という反応
- 他サーバーへの自発的共有

---

## 9. 将来拡張（参考）

- 投票履歴の保存
- 集まりやすい時間帯の可視化
- VC 開始検知による `/now` 提案
- 静かなリマインド
- LangStats との統合

---

## 10. 撤退条件

- 再利用が発生しない
- 管理者以外が使わない
- 自然な会話・行動に繋がらない

---

## 11. 次のアクション

1. プロジェクト初期化（Node.js + TypeScript + Discord.js）
2. `/soon` コマンド実装
3. `/later` コマンド実装
4. リアクション投票機能実装（排他制御含む）
5. 閾値通知機能実装
6. 自動クローズ機能実装
7. テストサーバーでの動作検証
